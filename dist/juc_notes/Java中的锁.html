<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mister-hope.github.io/my-docs/juc_notes/Java%E4%B8%AD%E7%9A%84%E9%94%81.html"><meta property="og:title" content="Java ä¸­çš„é”"><meta property="og:description" content="è®°å½• Java ä¸­çš„å„ç§ "é”" äº‹å„¿ã€‚"><meta property="og:type" content="article"><meta property="og:image" content="https://mister-hope.github.io/my-docs/"><meta property="og:locale" content="en-US"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Java ä¸­çš„é”"><meta property="article:author" content="Jimmy"><meta property="article:tag" content="å¹¶å‘"><meta property="article:published_time" content="2023-07-16T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Java ä¸­çš„é”","image":["https://mister-hope.github.io/my-docs/"],"datePublished":"2023-07-16T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"Jimmy"}]}</script><title>Java ä¸­çš„é”</title><meta name="description" content="è®°å½• Java ä¸­çš„å„ç§ "é”" äº‹å„¿ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/my-docs/assets/style-9ab5446d.css" as="style"><link rel="stylesheet" href="/my-docs/assets/style-9ab5446d.css">
    <link rel="modulepreload" href="/my-docs/assets/app-5c2ec4fa.js"><link rel="modulepreload" href="/my-docs/assets/framework-b5ea9e64.js"><link rel="modulepreload" href="/my-docs/assets/Javaä¸­çš„é”.html-148a323f.js"><link rel="modulepreload" href="/my-docs/assets/Javaä¸­çš„é”.html-7ad0a06f.js"><link rel="prefetch" href="/my-docs/assets/intro.html-3c1366e3.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-466673c2.js" as="script"><link rel="prefetch" href="/my-docs/assets/slides.html-32b30afe.js" as="script"><link rel="prefetch" href="/my-docs/assets/disable.html-dadeb134.js" as="script"><link rel="prefetch" href="/my-docs/assets/encrypt.html-f90755a2.js" as="script"><link rel="prefetch" href="/my-docs/assets/markdown.html-4ba53583.js" as="script"><link rel="prefetch" href="/my-docs/assets/page.html-e6abe24e.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-1a6abd13.js" as="script"><link rel="prefetch" href="/my-docs/assets/Java_collection.html-5255e6fe.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-cfabd979.js" as="script"><link rel="prefetch" href="/my-docs/assets/deploy_Vuepress.html-8ed0f69a.js" as="script"><link rel="prefetch" href="/my-docs/assets/Java_basic.html-994b1418.js" as="script"><link rel="prefetch" href="/my-docs/assets/notes.html-e8000a77.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC02_LockSupportä¸ä¸­æ–­.html-e7735e6b.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC03Javaå†…å­˜æ¨¡å‹JMM.html-0e5cca6b.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC04_CAS.html-fe8da747.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC05_çº¿ç¨‹æ± ä¸å¹¶å‘å·¥å…·.html-b25c0108.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC06_ThreadLocal.html-715c33e9.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-58d38f80.js" as="script"><link rel="prefetch" href="/my-docs/assets/dockerä¸­å®‰è£…redis.html-2e049d2d.js" as="script"><link rel="prefetch" href="/my-docs/assets/Javaä¸­çš„é”.html-75dadfd2.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC02_LockSupportä¸ä¸­æ–­.html-b6b59ff3.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC03Javaå†…å­˜æ¨¡å‹JMM.html-6be95cec.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC04_CAS.html-3d2f7652.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC05_çº¿ç¨‹æ± ä¸å¹¶å‘å·¥å…·.html-d309384d.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC06_ThreadLocal.html-2952a12b.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-49c2c5fb.js" as="script"><link rel="prefetch" href="/my-docs/assets/404.html-faf953b6.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-cc4e1394.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-bfc5bb8e.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-238c490d.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-4bb66cea.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-078ca550.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-94a2cc5b.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-45950628.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-7d321ad5.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-d8bd306e.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-eee533f5.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-13963d5a.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-82f3145c.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-7bfaa3a3.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-7ccfc88f.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-bd09ce65.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-242f3641.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-e2f00287.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-e08e3d6d.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-5a95a274.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-b93fa51f.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-ea97c984.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-b7a75456.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-4e12ad1c.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-39953899.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-f15d0f34.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-34bf2dd6.js" as="script"><link rel="prefetch" href="/my-docs/assets/intro.html-88bbbba3.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-f6fd53c8.js" as="script"><link rel="prefetch" href="/my-docs/assets/slides.html-7d6ea186.js" as="script"><link rel="prefetch" href="/my-docs/assets/disable.html-66a5c74b.js" as="script"><link rel="prefetch" href="/my-docs/assets/encrypt.html-3033137a.js" as="script"><link rel="prefetch" href="/my-docs/assets/markdown.html-04645215.js" as="script"><link rel="prefetch" href="/my-docs/assets/page.html-8678032e.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-00448ff8.js" as="script"><link rel="prefetch" href="/my-docs/assets/Java_collection.html-95e4e0b1.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-ad4dbd5c.js" as="script"><link rel="prefetch" href="/my-docs/assets/deploy_Vuepress.html-bddc4d8a.js" as="script"><link rel="prefetch" href="/my-docs/assets/Java_basic.html-d9f56b68.js" as="script"><link rel="prefetch" href="/my-docs/assets/notes.html-453c6c52.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC02_LockSupportä¸ä¸­æ–­.html-7dc61327.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC03Javaå†…å­˜æ¨¡å‹JMM.html-427ff2c1.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC04_CAS.html-86ef9068.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC05_çº¿ç¨‹æ± ä¸å¹¶å‘å·¥å…·.html-ce80f47b.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC06_ThreadLocal.html-78509b3c.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-d4a810a8.js" as="script"><link rel="prefetch" href="/my-docs/assets/dockerä¸­å®‰è£…redis.html-5c758f5b.js" as="script"><link rel="prefetch" href="/my-docs/assets/Javaä¸­çš„é”.html-31c7920d.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC02_LockSupportä¸ä¸­æ–­.html-91a0ba4e.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC03Javaå†…å­˜æ¨¡å‹JMM.html-13a232e5.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC04_CAS.html-ebbab916.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC05_çº¿ç¨‹æ± ä¸å¹¶å‘å·¥å…·.html-7d819064.js" as="script"><link rel="prefetch" href="/my-docs/assets/JUC06_ThreadLocal.html-dd4236f7.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-9e123180.js" as="script"><link rel="prefetch" href="/my-docs/assets/404.html-efcbdfb8.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-91822548.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-4f9a4b5f.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-11b87b78.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-b93c98f4.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-980af55e.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-e82c4191.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-ca4faf6e.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-025251c7.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-a36273be.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-64389379.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-da90ef68.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-d80f1d2d.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-7c752282.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-a3cf3b28.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-9a262995.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-28bf1937.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-c20b48b5.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-616a6c28.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-5551fcaa.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-7a0739b7.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-ff2ab13e.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-f69eb88c.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-c8e4cb15.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-7a26a869.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-dbf81064.js" as="script"><link rel="prefetch" href="/my-docs/assets/index.html-6ee8b06d.js" as="script"><link rel="prefetch" href="/my-docs/assets/giscus-9b97f17f.js" as="script"><link rel="prefetch" href="/my-docs/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/my-docs/assets/index-8764208e.js" as="script"><link rel="prefetch" href="/my-docs/assets/flowchart-35969cab.js" as="script"><link rel="prefetch" href="/my-docs/assets/mermaid.core-56228b1e.js" as="script"><link rel="prefetch" href="/my-docs/assets/highlight.esm-a794bb63.js" as="script"><link rel="prefetch" href="/my-docs/assets/markdown.esm-d92a2fc9.js" as="script"><link rel="prefetch" href="/my-docs/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/my-docs/assets/notes.esm-224f94d9.js" as="script"><link rel="prefetch" href="/my-docs/assets/reveal.esm-e5069ce0.js" as="script"><link rel="prefetch" href="/my-docs/assets/search.esm-2c3fba7d.js" as="script"><link rel="prefetch" href="/my-docs/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/my-docs/assets/VuePlayground-f72ed70e.js" as="script"><link rel="prefetch" href="/my-docs/assets/photoswipe.esm-6e6cbe40.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/my-docs/" class="brand"><img class="logo" src="/my-docs/logo.svg" alt><!----><!----></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æŠ€æœ¯æ–‡ç« "><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>æŠ€æœ¯æ–‡ç« </span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/my-docs/juc_notes" class="nav-link active" aria-label="JUC"><span class="font-icon icon iconfont icon-java" style=""></span>JUC<!----></a></li><li class="dropdown-item"><a href="/my-docs/java" class="nav-link" aria-label="java"><span class="font-icon icon iconfont icon-java" style=""></span>java<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="ç”Ÿæ´»"><span class="title"><span class="font-icon icon iconfont icon-java" style=""></span>ç”Ÿæ´»</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/my-docs/juc_notes" class="nav-link active" aria-label="JUC"><span class="font-icon icon iconfont icon-java" style=""></span>JUC<!----></a></li><li class="dropdown-item"><a href="/my-docs/java" class="nav-link" aria-label="java"><span class="font-icon icon iconfont icon-java" style=""></span>java<!----></a></li></ul></button></div></div></nav><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-java" style=""></span><span class="title">Java</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-database" style=""></span><span class="title">æ•°æ®åº“</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-spring" style=""></span><span class="title">spring</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-computer" style=""></span><span class="title">è®¡ç®—æœºåŸºç¡€</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-other" style=""></span><span class="title">other</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="font-icon icon iconfont icon-demo" style=""></span><span class="title">demo</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="font-icon icon iconfont icon-page" style=""></span>Java ä¸­çš„é”</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Jimmy</span></span><span property="author" content="Jimmy"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-07-16T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 24 min</span><meta property="timeRequired" content="PT24M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="page-category-item category6 clickable" role="navigation">java</span><span class="page-category-item category7 clickable" role="navigation">JUC</span><meta property="articleSection" content="java,JUC"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="page-tag-item tag6 clickable" role="navigation">å¹¶å‘</span><meta property="keywords" content="å¹¶å‘"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">On This Page<button class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/my-docs/juc_notes/Java%E4%B8%AD%E7%9A%84%E9%94%81.html#_1ã€synchronized" class="router-link-active router-link-exact-active toc-link level1">1ã€synchronized</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/my-docs/juc_notes/Java%E4%B8%AD%E7%9A%84%E9%94%81.html#_2ã€å¯¹è±¡å¤´ä¸é”-monitor" class="router-link-active router-link-exact-active toc-link level1">2ã€å¯¹è±¡å¤´ä¸é”ï¼ˆMonitorï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/my-docs/juc_notes/Java%E4%B8%AD%E7%9A%84%E9%94%81.html#_3ã€jitç¼–è¯‘å™¨å¯¹é”çš„ä¼˜åŒ–" class="router-link-active router-link-exact-active toc-link level1">3ã€JITç¼–è¯‘å™¨å¯¹é”çš„ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/my-docs/juc_notes/Java%E4%B8%AD%E7%9A%84%E9%94%81.html#_4-é”çš„æ´»è·ƒæ€§é—®é¢˜" class="router-link-active router-link-exact-active toc-link level1">4.é”çš„æ´»è·ƒæ€§é—®é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/my-docs/juc_notes/Java%E4%B8%AD%E7%9A%84%E9%94%81.html#å‚è€ƒ" class="router-link-active router-link-exact-active toc-link level1">å‚è€ƒ</a></li><!----><!--]--></ul></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><p>è®°å½• <code>Java</code> ä¸­çš„å„ç§ &quot;é”&quot; äº‹å„¿ã€‚</p><!-- more --><h1 id="_1ã€synchronized" tabindex="-1"><a class="header-anchor" href="#_1ã€synchronized" aria-hidden="true">#</a> 1ã€synchronized</h1><h2 id="_1-1-synchronizedçš„è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#_1-1-synchronizedçš„è§£é‡Š" aria-hidden="true">#</a> 1.1 synchronizedçš„è§£é‡Š</h2><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">synchronized</span><span class="token punctuation">(</span>é”å¯¹è±¡<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// ä¸´ç•ŒåŒº</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>synchronizedï¼šå¯¹è±¡é”ï¼Œä¿è¯äº†ä¸´ç•ŒåŒºå†…ä»£ç çš„åŸå­æ€§</strong>ï¼Œé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰å¯¹è±¡é”ï¼Œå…¶å®ƒçº¿ç¨‹è·å–è¿™ä¸ªå¯¹è±¡é”æ—¶ä¼šé˜»å¡ï¼Œä¿è¯æ‹¥æœ‰é”çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</p><p>äº’æ–¥å’ŒåŒæ­¥éƒ½å¯ä»¥é‡‡ç”¨ synchronized å…³é”®å­—æ¥å®Œæˆï¼ŒåŒºåˆ«ï¼š</p><ul><li>äº’æ–¥æ˜¯ä¿è¯ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </li><li>åŒæ­¥æ˜¯ç”±äºçº¿ç¨‹æ‰§è¡Œçš„å…ˆåã€é¡ºåºä¸åŒã€éœ€è¦ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹è¿è¡Œåˆ°æŸä¸ªç‚¹</li></ul><p>æ€§èƒ½ï¼š</p><ul><li>çº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å·®</li><li>çº¿ç¨‹ä¸å®‰å…¨æ€§èƒ½å¥½ï¼Œå‡å¦‚å¼€å‘ä¸­ä¸ä¼šå­˜åœ¨å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨çº¿ç¨‹ä¸å®‰å…¨çš„è®¾è®¡ç±»</li></ul><h2 id="_1-2-synchronizedçš„ç”¨æ³•" tabindex="-1"><a class="header-anchor" href="#_1-2-synchronizedçš„ç”¨æ³•" aria-hidden="true">#</a> 1.2 synchronizedçš„ç”¨æ³•</h2><ol><li>åŒæ­¥ä»£ç å—+å¯¹è±¡é”</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">IncreaseAndDecrease</span> inde <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IncreaseAndDecrease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>inde<span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>åŒæ­¥æ–¹æ³•+å¯¹è±¡é”</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç­‰ä»·äºï¼š</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>åŒæ­¥é™æ€æ–¹æ³•+å¯¹è±¡é”</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> counter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç­‰ä»·äºï¼š</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">synchronized</span><span class="token punctuation">(</span>å½“å‰ç±»<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç”¨æ³•å°æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ç”¨æ³•å°æ€»ç»“" aria-hidden="true">#</a> ç”¨æ³•å°æ€»ç»“</h3><ol><li>éé™æ€æ–¹æ³•çš„é»˜è®¤é”ä¸º thisï¼Œé™æ€æ–¹æ³•çš„é”é»˜è®¤ä¸ºClasså®ä¾‹ã€‚</li><li>åœ¨æŸä¸€ä¸ªæ—¶åˆ»å†…ï¼Œä¹‹èƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”ï¼Œæ— è®ºå‡ ä¸ªæ–¹æ³•ã€‚</li><li>æ›´å¤šæ¡ˆä¾‹å¯ä»¥å‚è€ƒï¼š<a href="https://blog.csdn.net/qq_43521756/article/details/107401896" target="_blank" rel="noopener noreferrer">çº¿ç¨‹å…«é”<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><h2 id="_1-3-çº¿ç¨‹å®‰å…¨åˆ†æ" tabindex="-1"><a class="header-anchor" href="#_1-3-çº¿ç¨‹å®‰å…¨åˆ†æ" aria-hidden="true">#</a> 1.3 çº¿ç¨‹å®‰å…¨åˆ†æ</h2><p>åˆ†æç¨‹åºæ˜¯å¦æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä¸»è¦å°±æ˜¯çœ‹æ˜¯å¦æœ‰<strong>å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªèµ„æºå˜é‡</strong>ã€‚ <strong>ä¾‹å­1</strong>ï¼šä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸¤ä¸ªçº¿ç¨‹æ“ä½œçš„éƒ½æ˜¯å±€éƒ¨å˜é‡ï¼Œä¸å­˜åœ¨å…±äº«é—®é¢˜ï¼Œæ‰€ä»¥æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">chapter02</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadSafeAnalysis</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ThreadSafe</span> threadSafe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                threadSafe<span class="token punctuation">.</span><span class="token function">method01</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;Thread 01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">ThreadSafe</span> threadSafe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadSafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                threadSafe<span class="token punctuation">.</span><span class="token function">method01</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;Thread 02&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ThreadSafe</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method01</span><span class="token punctuation">(</span><span class="token keyword">int</span> loopnumber<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// list ä¸ºå±€éƒ¨å˜é‡æ•…è€Œï¼Œæ¯ä¸ªçº¿ç¨‹è°ƒç”¨method01æ–¹æ³•éƒ½ä¼šåˆ›å»ºä¸€ä¸ªlistå¯¹è±¡</span>
        <span class="token comment">// æ‰€ä»¥ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> loopnumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">method2</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">method3</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å­2ï¼šå°†ä¸Šé¢ä¾‹å­ä¸­çš„ <code>method3</code> ä¿®æ”¹å¦‚ä¸‹ã€‚è¿™æ ·å°±ä¼šå‡ºç°ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—® listï¼ˆã€Thread 01 ä¸ Thread 03ã€‘æˆ–è€…ã€Thread 02 ä¸ Thread 03ã€‘ï¼‰ã€‚è¿™æ ·å°±ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;Thread 03&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="çº¿ç¨‹å®‰å…¨çš„è®¾è®¡å»ºè®®" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹å®‰å…¨çš„è®¾è®¡å»ºè®®" aria-hidden="true">#</a> çº¿ç¨‹å®‰å…¨çš„è®¾è®¡å»ºè®®</h4><ol><li>è®¾è®¡ç¨‹åºæ—¶ï¼Œä¸è¯¥æš´éœ²ç»™å¤–éƒ¨çš„æ–¹æ³•ä¸€å®šè¦ç§æœ‰åŒ–ï¼Œé˜²æ­¢å­ç±»é‡å†™ã€‚</li><li>æš´éœ²ç»™å¤–éƒ¨çš„æ–¹æ³•ï¼Œè€ƒè™‘æ˜¯å¦éœ€è¦finalï¼Œé˜²æ­¢å­ç±»é‡å†™ã€‚</li><li>å½“å‰è®¾è®¡çš„ç±»ï¼Œæ˜¯å¦éœ€è¦è¢«ç»§æ‰¿ï¼Œå¦‚æœä¸éœ€è¦å¯ç›´æ¥finalä¿®é¥°æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</li></ol><h2 id="_1-4-å¸¸è§çš„çº¿ç¨‹å®‰å…¨ç±»" tabindex="-1"><a class="header-anchor" href="#_1-4-å¸¸è§çš„çº¿ç¨‹å®‰å…¨ç±»" aria-hidden="true">#</a> 1.4 å¸¸è§çš„çº¿ç¨‹å®‰å…¨ç±»</h2><ul><li>String</li><li>Integer</li><li>StringBuffer</li><li>Random</li><li>Vector</li><li>Hashtable</li><li>JUCåŒ…ä¸‹çš„ç±»</li></ul><h1 id="_2ã€å¯¹è±¡å¤´ä¸é”-monitor" tabindex="-1"><a class="header-anchor" href="#_2ã€å¯¹è±¡å¤´ä¸é”-monitor" aria-hidden="true">#</a> 2ã€å¯¹è±¡å¤´ä¸é”ï¼ˆMonitorï¼‰</h1><p>JVMä¸­å¯¹è±¡å¤´çš„æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ï¼ˆä»¥32ä½JVMä¸ºä¾‹ï¼‰ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>                     <span class="token class-name">Object</span> <span class="token class-name">Header</span> <span class="token punctuation">(</span><span class="token number">64</span> bits<span class="token punctuation">)</span>                  <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token class-name">Mark</span> <span class="token class-name">Word</span> <span class="token punctuation">(</span><span class="token number">32</span> bits<span class="token punctuation">)</span>         <span class="token operator">|</span>    <span class="token class-name">Klass</span> <span class="token class-name">Word</span> <span class="token punctuation">(</span><span class="token number">32</span> bits<span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span>
<span class="token class-name">Klass</span> <span class="token class-name">Word</span>ï¼šæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å¯¹è±¡ã€‚
# æ•°ç»„å¯¹è±¡
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span>
<span class="token operator">|</span>                                 <span class="token class-name">Object</span> <span class="token class-name">Header</span> <span class="token punctuation">(</span><span class="token number">96</span> bits<span class="token punctuation">)</span>                         <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token class-name">Mark</span> <span class="token class-name">Word</span><span class="token punctuation">(</span><span class="token number">32</span>bits<span class="token punctuation">)</span>       <span class="token operator">|</span>    <span class="token class-name">Klass</span> <span class="token class-name">Word</span><span class="token punctuation">(</span><span class="token number">32</span>bits<span class="token punctuation">)</span> <span class="token operator">|</span>  array <span class="token function">length</span><span class="token punctuation">(</span><span class="token number">32</span>bits<span class="token punctuation">)</span>  <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-1-å¯¹è±¡å¤´çš„ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#_2-1-å¯¹è±¡å¤´çš„ç»„æˆ" aria-hidden="true">#</a> 2.1 å¯¹è±¡å¤´çš„ç»„æˆ</h2><h3 id="_2-1-1-mark-word" tabindex="-1"><a class="header-anchor" href="#_2-1-1-mark-word" aria-hidden="true">#</a> 2.1.1 Mark Word</h3><p>è¿™éƒ¨åˆ†ä¸»è¦ç”¨æ¥å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚ <code>hashcodeã€gc</code> åˆ†ä»£å¹´é¾„ç­‰ã€‚<code>mark word</code> çš„ä½é•¿åº¦ä¸º JVM çš„ä¸€ä¸ª Word å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´32ä½JVMçš„ Mark word ä¸º32ä½ï¼Œ64ä½JVMä¸º64ä½ã€‚ä¸ºäº†è®©ä¸€ä¸ªå­—å¤§å°å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ï¼ŒJVMå°†å­—çš„æœ€ä½ä¸¤ä¸ªä½è®¾ç½®ä¸ºæ ‡è®°ä½ï¼Œä¸åŒæ ‡è®°ä½ä¸‹çš„Mark Wordç¤ºæ„å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token class-name">Mark</span> <span class="token class-name">Word</span> <span class="token punctuation">(</span><span class="token number">32</span> bits<span class="token punctuation">)</span>                  <span class="token operator">|</span>       <span class="token class-name">State</span>        <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span> hashcode<span class="token operator">:</span><span class="token number">25</span> <span class="token operator">|</span> age<span class="token operator">:</span><span class="token number">4</span> <span class="token operator">|</span> biased_lock<span class="token operator">:</span><span class="token number">0</span> 		   <span class="token operator">|</span> <span class="token number">01</span> 	<span class="token operator">|</span>       <span class="token class-name">Normal</span>       <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>  thread<span class="token operator">:</span><span class="token number">23</span> <span class="token operator">|</span> epoch<span class="token operator">:</span><span class="token number">2</span> <span class="token operator">|</span> age<span class="token operator">:</span><span class="token number">4</span> <span class="token operator">|</span> biased_lock<span class="token operator">:</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token number">01</span> 	<span class="token operator">|</span>       <span class="token class-name">Biased</span>       <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>               ptr_to_lock_record<span class="token operator">:</span><span class="token number">30</span>          <span class="token operator">|</span> <span class="token number">00</span> 	<span class="token operator">|</span> <span class="token class-name">Lightweight</span> <span class="token class-name">Locked</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>               ptr_to_heavyweight_monitor<span class="token operator">:</span><span class="token number">30</span>  <span class="token operator">|</span> <span class="token number">10</span> 	<span class="token operator">|</span> <span class="token class-name">Heavyweight</span> <span class="token class-name">Locked</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>                                              <span class="token operator">|</span> <span class="token number">11</span> 	<span class="token operator">|</span>    <span class="token class-name">Marked</span> <span class="token keyword">for</span> <span class="token constant">GC</span>   <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>biased_lock</strong>ï¼šå¯¹è±¡æ˜¯å¦å¯ç”¨åå‘é”æ ‡è®°ï¼Œåªå 1ä¸ªäºŒè¿›åˆ¶ä½ã€‚ä¸º1æ—¶è¡¨ç¤ºå¯¹è±¡å¯ç”¨åå‘é”ï¼Œä¸º0æ—¶è¡¨ç¤ºå¯¹è±¡æ²¡æœ‰åå‘é”ã€‚</li><li><strong>age</strong>ï¼š4ä½çš„ Java å¯¹è±¡å¹´é¾„ã€‚åœ¨GCä¸­ï¼Œå¦‚æœå¯¹è±¡åœ¨<strong>Survivor</strong>åŒºå¤åˆ¶ä¸€æ¬¡ï¼Œå¹´é¾„å¢åŠ 1ã€‚å½“å¯¹è±¡è¾¾åˆ°è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œå°†ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¹¶è¡ŒGCçš„å¹´é¾„é˜ˆå€¼ä¸º15ï¼Œå¹¶å‘GCçš„å¹´é¾„é˜ˆå€¼ä¸º6ã€‚ç”±äºageåªæœ‰4ä½ï¼Œæ‰€ä»¥æœ€å¤§å€¼ä¸º15ï¼Œè¿™å°±æ˜¯ <code>-XX:MaxTenuringThreshold</code> é€‰é¡¹æœ€å¤§å€¼ä¸º15çš„åŸå› ã€‚</li><li>identity_hashcodeï¼š25ä½çš„å¯¹è±¡æ ‡è¯†Hashç ï¼Œé‡‡ç”¨å»¶è¿ŸåŠ è½½æŠ€æœ¯ã€‚è°ƒç”¨æ–¹æ³• <code>System.identityHashCode()</code> è®¡ç®—ï¼Œå¹¶ä¼šå°†ç»“æœå†™åˆ°è¯¥å¯¹è±¡å¤´ä¸­ã€‚å½“å¯¹è±¡è¢«é”å®šæ—¶ï¼Œè¯¥å€¼ä¼šç§»åŠ¨åˆ°ç®¡ç¨‹ <code>Monitor</code> ä¸­ã€‚</li><li>threadï¼šæŒæœ‰åå‘é”çš„çº¿ç¨‹IDã€‚</li><li>epochï¼šåå‘æ—¶é—´æˆ³ã€‚</li><li>ptr_to_lock_recordï¼šæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆã€‚</li><li>ptr_to_heavyweight_monitorï¼šæŒ‡å‘ç®¡ç¨‹Monitorçš„æŒ‡é’ˆã€‚</li></ul><h3 id="_2-1-2-ä»javaå¯¹è±¡çœ‹-mark-word" tabindex="-1"><a class="header-anchor" href="#_2-1-2-ä»javaå¯¹è±¡çœ‹-mark-word" aria-hidden="true">#</a> 2.1.2 ä»Javaå¯¹è±¡çœ‹ Mark Word</h3><figure><img src="/my-docs/assets/d9a22a61229c41f5989bc2cf55a819a0-ce91d144.png" alt="markwordçš„ç»“æ„" tabindex="0" loading="lazy"><figcaption>markwordçš„ç»“æ„</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">/*
    æƒ…å†µä¸€ï¼šè°ƒç”¨hashcode
    10è¿›åˆ¶çš„Hashç ï¼š1554874502
	16è¿›åˆ¶çš„Hashç ï¼š5c ad 80 86
	2è¿›åˆ¶çš„Hashç ï¼š1011100101011011000000010000110
				01011100101011011000000010000110
      0     4        (object header)                           01 86 80 ad (00000001 10000110 10000000 10101101) (-1384086015)
      4     4        (object header)                           5c 00 00 00 (01011100 00000000 00000000 00000000) (92)
      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)

    æƒ…å†µäºŒï¼šä¸è°ƒç”¨HashCode
      0     4        (object header)                           01 00 00 00 (00000001 00000000 00000000 00000000) (1)
      4     4        (object header)                           00 00 00 00 (00000000 00000000 00000000 00000000) (0)
      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        System.out.println(&quot;10è¿›åˆ¶çš„Hashç ï¼š&quot;+o.hashCode());</span>
<span class="token comment">//        System.out.println(&quot;16è¿›åˆ¶çš„Hashç ï¼š&quot;+Integer.toHexString(o.hashCode()));</span>
<span class="token comment">//        System.out.println(&quot;2è¿›åˆ¶çš„Hashç ï¼š&quot;+Integer.toBinaryString(o.hashCode()));</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ— é”çŠ¶æ€çš„å¯¹è±¡å¤´ï¼š&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayou</span>	t<span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æƒ…å†µäºŒï¼šä¸è°ƒç”¨HashCode</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>
ç¬¬ä¸€è¡Œ  <span class="token number">0</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
ç¬¬äºŒè¡Œ  <span class="token number">4</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
ç¬¬ä¸‰è¡Œ  <span class="token number">8</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           e5 <span class="token number">01</span> <span class="token number">00</span> f8 <span class="token punctuation">(</span><span class="token number">11100101</span> <span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">11111000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">134217243</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆä»ç¬¬äºŒè¡Œçš„æœ€åä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œå¾€å‰é€ä¸ªå­—èŠ‚çš„æ’åˆ—ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹äºŒè¿›åˆ¶åºåˆ—ï¼š</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>00000000 00000000 00000000 0 0000000 00000000 00000000 00000000         0 		   0000       0    		   01
|---------unusedï¼ˆ25ä½ï¼‰----| |------hashcodeï¼ˆ31ä½ï¼‰------------| |-unusedï¼ˆ1ä½ï¼‰-| |-age-| |-åå‘é”ä½ç½®-| |-é”æ ‡å¿—ä½ç½®-|
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æƒ…å†µä¸€ï¼šè°ƒç”¨hashcodeæ–¹æ³•</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token number">10</span>è¿›åˆ¶çš„<span class="token class-name">Hash</span>ç ï¼š<span class="token number">1554874502</span>
	<span class="token number">16</span>è¿›åˆ¶çš„<span class="token class-name">Hash</span>ç ï¼š<span class="token number">5</span>c ad <span class="token number">80</span> <span class="token number">86</span>
	<span class="token number">2</span>è¿›åˆ¶çš„<span class="token class-name">Hash</span>ç ï¼š<span class="token number">1011100101011011000000010000110</span>
				 <span class="token number">1011100101011011000000010000110</span>
      <span class="token number">0</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">01</span> <span class="token number">86</span> <span class="token number">80</span> ad <span class="token punctuation">(</span><span class="token number">00000001</span> <span class="token number">10000110</span> <span class="token number">10000000</span> <span class="token number">10101101</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1384086015</span><span class="token punctuation">)</span>
      <span class="token number">4</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           <span class="token number">5</span>c <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token punctuation">(</span><span class="token number">01011100</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token number">92</span><span class="token punctuation">)</span>
      <span class="token number">8</span>     <span class="token number">4</span>        <span class="token punctuation">(</span>object header<span class="token punctuation">)</span>                           e5 <span class="token number">01</span> <span class="token number">00</span> f8 <span class="token punctuation">(</span><span class="token number">11100101</span> <span class="token number">00000001</span> <span class="token number">00000000</span> <span class="token number">11111000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">134217243</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é¦–å…ˆä»ç¬¬äºŒè¡Œçš„æœ€åä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œå¾€å‰é€ä¸ªå­—èŠ‚çš„æ’åˆ—ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹äºŒè¿›åˆ¶åºåˆ—ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">01011100</span> <span class="token number">10101101</span> <span class="token number">10000000</span> <span class="token number">10000110</span> <span class="token number">00000001</span>
å¯¹å…¶è¿›è¡Œåˆ’åˆ†ï¼š
<span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">00000000</span> <span class="token number">0</span> <span class="token number">1011100</span> <span class="token number">10101101</span> <span class="token number">10000000</span> <span class="token number">10000110</span>        <span class="token number">0</span>          <span class="token number">0000</span>        <span class="token number">0</span>            <span class="token number">01</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>unusedï¼ˆ<span class="token number">25</span>ä½ï¼‰<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span> <span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>hashcodeï¼ˆ<span class="token number">31</span>ä½ï¼‰<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span> <span class="token operator">|</span><span class="token operator">-</span>unusedï¼ˆ<span class="token number">1</span>ä½ï¼‰<span class="token operator">-</span><span class="token operator">|</span> <span class="token operator">|</span><span class="token operator">-</span>age<span class="token operator">-</span><span class="token operator">|</span> <span class="token operator">|</span><span class="token operator">-</span>åå‘é”ä½ç½®<span class="token operator">-</span><span class="token operator">|</span> <span class="token operator">|</span><span class="token operator">-</span>é”æ ‡å¿—ä½ç½®<span class="token operator">-</span><span class="token operator">|</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŠ é”ä¹‹åçš„markwordæœ‰ä»€ä¹ˆå˜åŒ–ï¼Œåœ¨2.3èŠ‚è¿›è¡Œåˆ†æã€‚</p><h2 id="_2-2-monitor" tabindex="-1"><a class="header-anchor" href="#_2-2-monitor" aria-hidden="true">#</a> 2.2 Monitor</h2><p>Monitor è¢«ç¿»è¯‘ä¸ºç›‘è§†å™¨æˆ–ç®¡ç¨‹ã€‚åœ¨HotSpotè™šæ‹Ÿæœºä¸­ï¼ŒMonitoræ˜¯åŸºäºC++çš„<code>ObjectMonitor</code>ç±»å®ç°çš„ï¼Œå…¶ä¸»è¦æˆå‘˜åŒ…æ‹¬ï¼š</p><ul><li>_ownerï¼šæŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹</li><li>_WaitSetï¼šå­˜æ”¾å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹é˜Ÿåˆ—ï¼Œå³è°ƒç”¨wait()æ–¹æ³•çš„çº¿ç¨‹</li><li>_EntryListï¼šå­˜æ”¾å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹é˜Ÿåˆ—</li><li>_countï¼šçº¦ä¸º_WaitSet å’Œ _EntryList çš„èŠ‚ç‚¹æ•°ä¹‹å’Œ</li><li>_cxq: å¤šä¸ªçº¿ç¨‹äº‰æŠ¢é”ï¼Œä¼šå…ˆå­˜å…¥è¿™ä¸ªå•å‘é“¾è¡¨</li><li>_recursions: è®°å½•é‡å…¥æ¬¡æ•°</li></ul><p>æ¯ä¸ª Java å¯¹è±¡éƒ½å¯ä»¥å…³è”ä¸€ä¸ª Monitor å¯¹è±¡ï¼ŒMonitor ä¹Ÿæ˜¯ classï¼Œå…¶<strong>å®ä¾‹å­˜å‚¨åœ¨å †ä¸­</strong>ï¼Œå¦‚æœä½¿ç”¨ synchronized ç»™å¯¹è±¡ä¸Šé”ï¼ˆé‡é‡çº§ï¼‰ä¹‹åï¼Œè¯¥å¯¹è±¡å¤´çš„ Mark Word ä¸­å°±è¢«è®¾ç½®æŒ‡å‘ Monitor å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¿™å°±æ˜¯é‡é‡çº§é”ã€‚</p><h3 id="_2-2-1-objectmonitorçš„å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-2-1-objectmonitorçš„å·¥ä½œæµç¨‹" aria-hidden="true">#</a> 2.2.1 ObjectMonitorçš„å·¥ä½œæµç¨‹</h3><figure><img src="/my-docs/assets/b2007030488f468ea9d71cec734815cd-aaf6456a.png" alt="Monitor" tabindex="0" loading="lazy"><figcaption>Monitor</figcaption></figure><ul><li>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€æ®µåŒæ­¥ä»£ç æ—¶ï¼Œé¦–å…ˆä¼šè¿›å…¥ <code>_EntryList </code> é˜Ÿåˆ—ä¸­ã€‚</li><li>å½“æŸä¸ªçº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„ Monitor åè¿›å…¥ä¸´ç•ŒåŒºåŸŸï¼Œå¹¶æŠŠ Monitor ä¸­çš„ <code>_owner</code> å˜é‡æŒ‡å‘<strong>åŒæ­¥å¯¹è±¡</strong>ï¼ŒåŒæ—¶Monitorä¸­çš„è®¡æ•°å™¨ _count åŠ 1ã€‚å³è·å¾—å¯¹è±¡é”ã€‚</li><li>è‹¥æŒæœ‰Monitorçš„çº¿ç¨‹è°ƒç”¨ wait() æ–¹æ³•ï¼Œå°†é‡Šæ”¾å½“å‰æŒæœ‰çš„Monitorï¼Œ_ownerå˜é‡æ¢å¤ä¸ºnullï¼Œ_countè‡ªå‡1ï¼ŒåŒæ—¶è¯¥çº¿ç¨‹è¿›å…¥ _WaitSet é›†åˆä¸­ç­‰å¾…è¢«å”¤é†’ã€‚</li><li>åœ¨_WaitSet é›†åˆä¸­çš„çº¿ç¨‹ä¼šè¢«å†æ¬¡æ”¾åˆ°_EntryList é˜Ÿåˆ—ä¸­ï¼Œé‡æ–°ç«äº‰è·å–é”ã€‚</li><li>è‹¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹Ÿå°†é‡Šæ”¾Monitorå¹¶å¤ä½å˜é‡çš„å€¼ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹è¿›å…¥è·å–é”ã€‚ <img src="/my-docs/assets/5b3a568e53a94f9ba9526379515fec30-f2904f1c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></li></ul><blockquote><p>æ³¨æ„ï¼š</p><ol><li>synchronized å¿…é¡»æ˜¯è¿›å…¥åŒä¸€ä¸ªå¯¹è±¡çš„ Monitor æ‰æœ‰ä¸Šè¿°çš„æ•ˆ</li><li>ä¸åŠ  synchronized çš„å¯¹è±¡ä¸ä¼šå…³è”ç›‘è§†å™¨ï¼Œä¸éµä»ä»¥ä¸Šè§„åˆ™</li></ol></blockquote><h3 id="_2-2-2-ä»å­—èŠ‚ç çš„è§’åº¦ç†è§£åŠ é”åŸç†" tabindex="-1"><a class="header-anchor" href="#_2-2-2-ä»å­—èŠ‚ç çš„è§’åº¦ç†è§£åŠ é”åŸç†" aria-hidden="true">#</a> 2.2.2 ä»å­—èŠ‚ç çš„è§’åº¦ç†è§£åŠ é”åŸç†</h3><ul><li>æƒ…å†µä¸€ï¼šåŒæ­¥ä»£ç å—</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token number">0</span><span class="token operator">:</span> 	<span class="token keyword">new</span>				#<span class="token number">2</span>		<span class="token comment">// new Object</span>
<span class="token number">3</span><span class="token operator">:</span> 	dup						<span class="token comment">// å¤åˆ¶ä¸€ä»½</span>
<span class="token number">4</span><span class="token operator">:</span> 	invokespecial 	#<span class="token number">1</span> 		<span class="token comment">// åˆå§‹åŒ–Objectå¯¹è±¡</span>
<span class="token number">7</span><span class="token operator">:</span> 	astore_1 				<span class="token comment">// å°†lockå¼•ç”¨å­˜å…¥æœ¬åœ°å˜é‡è¡¨1çš„ä½ç½®</span>
<span class="token number">8</span><span class="token operator">:</span> 	aload_1					<span class="token comment">// åŠ è½½lock ï¼ˆsynchronizedå¼€å§‹ï¼‰</span>
<span class="token number">9</span><span class="token operator">:</span> 	dup						<span class="token comment">// ä¸€ä»½ç”¨æ¥åˆå§‹åŒ–ï¼Œä¸€ä»½ç”¨æ¥å¼•ç”¨</span>
<span class="token number">10</span><span class="token operator">:</span> astore_2 				<span class="token comment">// å°†å¤åˆ¶çš„lockå¯¹è±¡å­˜å…¥æœ¬åœ°å˜é‡è¡¨2çš„ä½ç½®</span>
<span class="token number">11</span><span class="token operator">:</span> monitorenter 			<span class="token comment">// ã€å°† lockå¯¹è±¡ MarkWord ç½®ä¸º Monitor æŒ‡é’ˆã€‘</span>
<span class="token number">12</span><span class="token operator">:</span> getstatic 		#<span class="token number">3</span>		<span class="token comment">// System.out</span>
<span class="token number">15</span><span class="token operator">:</span> ldc 			#<span class="token number">4</span>		<span class="token comment">// &quot;ok&quot;</span>
<span class="token number">17</span><span class="token operator">:</span> invokevirtual 	#<span class="token number">5</span> 		<span class="token comment">// invokevirtual println:(Ljava/lang/String;)V</span>
<span class="token number">20</span><span class="token operator">:</span> aload_2 				<span class="token comment">// slot 2(lockå¼•ç”¨)</span>
<span class="token number">21</span><span class="token operator">:</span> monitorexit 			<span class="token comment">// ã€å°† lockå¯¹è±¡ MarkWord é‡ç½®, å”¤é†’ EntryListã€‘</span>
<span class="token number">22</span><span class="token operator">:</span> <span class="token keyword">goto</span> <span class="token number">30</span>
<span class="token comment">// ä¸‹é¢æ˜¯åŒæ­¥ä»£ç å—å‡ºç°å¼‚å¸¸åçš„æ“ä½œ</span>
<span class="token number">25</span><span class="token operator">:</span> astore_3 				<span class="token comment">//å¼‚å¸¸å¯¹è±¡å­˜å…¥æœ¬åœ°å˜é‡è¡¨3çš„ä½ç½® any -&gt; slot 3</span>
<span class="token number">26</span><span class="token operator">:</span> aload_2 				<span class="token comment">// slot 2(lockå¼•ç”¨)</span>
<span class="token number">27</span><span class="token operator">:</span> monitorexit 			<span class="token comment">// ã€å°† lockå¯¹è±¡ MarkWord é‡ç½®, å”¤é†’ EntryListã€‘</span>
<span class="token number">28</span><span class="token operator">:</span> aload_3 				<span class="token comment">// åŠ è½½å¼‚å¸¸</span>
<span class="token number">29</span><span class="token operator">:</span> athrow					<span class="token comment">// å°†å¼‚å¸¸æŠ›å‡º</span>
<span class="token number">30</span><span class="token operator">:</span> <span class="token keyword">return</span>
<span class="token class-name">Exception</span> table<span class="token operator">:</span>
    from <span class="token keyword">to</span> <span class="token namespace">target</span> type
      <span class="token number">12</span> <span class="token number">22</span> <span class="token number">25</span> 		any
      <span class="token number">25</span> <span class="token number">28</span> <span class="token number">25</span> 		any
<span class="token class-name">LineNumberTable</span><span class="token operator">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
    <span class="token class-name">Start</span> <span class="token class-name">Length</span> <span class="token class-name">Slot</span> <span class="token class-name">Name</span> <span class="token class-name">Signature</span>
    	<span class="token number">0</span> 	<span class="token number">31</span> 		<span class="token number">0</span> args <span class="token punctuation">[</span><span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">String</span><span class="token punctuation">;</span>
    	<span class="token number">8</span> 	<span class="token number">23</span> 		<span class="token number">1</span> lock <span class="token class-name">Ljava</span><span class="token operator">/</span>lang<span class="token operator">/</span><span class="token class-name">Object</span><span class="token punctuation">;</span>                    
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>è§£é‡Šï¼š 1 é€šè¿‡å¼‚å¸¸ <strong>try-catch æœºåˆ¶</strong>ï¼Œç¡®ä¿ä¸€å®šä¼šè¢«è§£é” 2 æ–¹æ³•çº§åˆ«çš„ synchronized ä¸ä¼šåœ¨å­—èŠ‚ç æŒ‡ä»¤ä¸­æœ‰æ‰€ä½“ç°</p></blockquote><ul><li>æƒ…å†µäºŒï¼šsynchronized æ™®é€šåŒæ­¥æ–¹æ³•</li></ul><p>è°ƒç”¨æŒ‡ä»¤å°†ä¼šæ£€æŸ¥æ–¹æ³•çš„<code>ACC_SYNCHRONIZED</code>è®¿é—®æ ‡å¿—æ˜¯å¦è¢«è®¾ç½®ï¼Œå¦‚æœè®¾ç½®äº†ï¼Œæ‰§è¡Œçº¿ç¨‹ä¼šå°†ç°æŒæœ‰monitoré”ï¼Œç„¶åå†æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œæœ€ååœ¨æ–¹æ³•å®Œæˆï¼ˆæ— è®ºæ˜¯å¦æ­£å¸¸ç»“æŸï¼‰æ—¶é‡Šæ”¾monitorã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>code<span class="token operator">:</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;åˆ†æéé™æ€æ–¹æ³•åŠ é”åçš„å­—èŠ‚ç ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Bytecode</span><span class="token operator">:</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_SYNCHRONIZED</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
      stack<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> locals<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> args_size<span class="token operator">=</span><span class="token number">1</span>
         <span class="token number">0</span><span class="token operator">:</span> getstatic     #<span class="token number">3</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
         <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">6</span>                  <span class="token comment">// String åˆ†æéé™æ€æ–¹æ³•åŠ é”åçš„å­—èŠ‚ç ä¿¡æ¯</span>
         <span class="token number">5</span><span class="token operator">:</span> invokevirtual #<span class="token number">5</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
         <span class="token number">8</span><span class="token operator">:</span> <span class="token keyword">return</span>
      <span class="token class-name">LineNumberTable</span><span class="token operator">:</span>
        line <span class="token number">13</span><span class="token operator">:</span> <span class="token number">0</span>
        line <span class="token number">14</span><span class="token operator">:</span> <span class="token number">8</span>
      <span class="token class-name">LocalVariableTable</span><span class="token operator">:</span>
        <span class="token class-name">Start</span>  <span class="token class-name">Length</span>  <span class="token class-name">Slot</span>  <span class="token class-name">Name</span>   <span class="token class-name">Signature</span>
            <span class="token number">0</span>       <span class="token number">9</span>     <span class="token number">0</span>  <span class="token keyword">this</span>   <span class="token class-name">Lchapter02</span><span class="token operator">/</span><span class="token class-name">ByteCodeAnalysis</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æƒ…å†µä¸‰ï¼šsynchronized é™æ€åŒæ­¥æ–¹æ³•</li></ul><p><code>ACC_STATICã€ACC_SYNCHRONIZED</code>è®¿é—®æ ‡å¿—åŒºåˆ†è¯¥æ–¹æ³•æ˜¯å¦æ˜¯é™æ€åŒæ­¥æ–¹æ³•ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    descriptor<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">V</span>
    flags<span class="token operator">:</span> <span class="token constant">ACC_PUBLIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_STATIC</span><span class="token punctuation">,</span> <span class="token constant">ACC_SYNCHRONIZED</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-3-ä¸ºä»€ä¹ˆæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”" tabindex="-1"><a class="header-anchor" href="#_2-2-3-ä¸ºä»€ä¹ˆæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”" aria-hidden="true">#</a> 2.2.3 ä¸ºä»€ä¹ˆæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªé”ï¼Ÿ</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>åœ¨<code>JVM</code>ä¸­æ¯ä¸ªJavaå¯¹è±¡éƒ½ä¼šå¯¹åº”ä¸€ä¸ªC++å®ç°çš„ <code>ObjectMonitor</code>ã€‚</p></li><li><p>å½“å¯¹ç¨‹åºè¿›è¡ŒåŠ é”æ—¶ï¼Œ<code>lock</code> å¯¹è±¡çš„å¯¹è±¡å¤´ä¸­çš„<code>markword</code>è¢«è®¾ç½®ä¸ºæŒ‡å‘ <code>ObjectMonitor</code>çš„æŒ‡é’ˆï¼ˆé‡é‡é”çš„æƒ…å†µï¼Œå…¶ä»–é”æœ‰äº›è®¸åŒºåˆ«ï¼‰ã€‚</p></li><li><p>å½“çº¿ç¨‹æŠ¢åˆ°é”åï¼Œ<code>ObjectMonitor</code>å¯¹è±¡ä¸­çš„<code>owner</code>å±æ€§ä¼šè¢«è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹å¯¹è±¡ï¼Œä»£è¡¨å½“å‰çº¿ç¨‹å·²ç»æŒæœ‰é”ã€‚<code>ObjectMonitor</code>å¯¹è±¡ä¼šè¢«é”å®šï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—é”ã€‚</p></li><li><p>å½“å‰çº¿ç¨‹é‡Šæ”¾é”ï¼Œ<code>owner</code>è®¾ç½®ä¸º <code>Null</code>ï¼Œå¹¶å”¤é†’å…¶ä»–çº¿ç¨‹è¿›è¡Œäº‰æªé”ã€‚</p></li></ol><h2 id="_2-3-synchronized-çš„å‡çº§è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#_2-3-synchronized-çš„å‡çº§è¿‡ç¨‹" aria-hidden="true">#</a> 2.3 synchronized çš„å‡çº§è¿‡ç¨‹</h2><p>åœ¨ Java æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œ<code>synchronized</code>å±äº<strong>é‡é‡çº§é”</strong>ï¼Œæ•ˆç‡ä½ä¸‹ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿæ¥å®ç°çš„ï¼ŒJava çš„çº¿ç¨‹æ˜¯æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ä¹‹ä¸Šçš„ã€‚å¦‚æœè¦æŒ‚èµ·æˆ–è€…å”¤é†’ä¸€ä¸ªçº¿ç¨‹ï¼Œéƒ½éœ€è¦æ“ä½œç³»ç»Ÿå¸®å¿™å®Œæˆï¼Œè€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»<strong>ç”¨æˆ·æ€è½¬æ¢åˆ°å†…æ ¸æ€</strong>ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ã€‚</p><p>åº†å¹¸çš„æ˜¯åœ¨ Java 6 ä¹‹å Java å®˜æ–¹å¯¹ä» JVM å±‚é¢å¯¹ <code>synchronized</code> è¾ƒå¤§ä¼˜åŒ–ï¼Œæ‰€ä»¥ç°åœ¨çš„ <code>synchronized</code> é”æ•ˆç‡ä¹Ÿä¼˜åŒ–å¾—å¾ˆä¸é”™äº†ã€‚JDK1.6 å¯¹é”çš„å®ç°å¼•å…¥äº†å¤§é‡çš„ä¼˜åŒ–ï¼Œå¦‚è‡ªæ—‹é”ã€é€‚åº”æ€§è‡ªæ—‹é”ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€åå‘é”ã€è½»é‡çº§é”ç­‰æŠ€æœ¯æ¥å‡å°‘é”æ“ä½œçš„å¼€é”€ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>æ— é”ï¼ˆCASï¼‰ -&gt; åå‘é” -&gt; è½»é‡çº§é” -&gt; é‡é‡çº§é”	// éšç€ç«äº‰çš„å¢åŠ ï¼Œåªèƒ½é”å‡çº§ï¼Œä¸èƒ½é™çº§
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>Synchronized</code>ç”¨çš„é”æ˜¯å­˜åœ¨<code>Java</code>å¯¹è±¡å¤´é‡Œçš„<code>MarkWord</code>ä¸­ï¼Œé”å‡çº§åŠŸèƒ½ä¸»è¦ä¾èµ–<code>MarkWord</code>ä¸­é”æ ‡å¿—ä½å’Œé‡Šæ”¾åå‘é”æ ‡å¿—ä½ã€‚</p><figure><img src="/my-docs/assets/d9a22a61229c41f5989bc2cf55a819a0-ce91d144.png" alt="markwordçš„ç»“æ„" tabindex="0" loading="lazy"><figcaption>markwordçš„ç»“æ„</figcaption></figure><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>                  <span class="token class-name">Mark</span> <span class="token class-name">Word</span> <span class="token punctuation">(</span><span class="token number">32</span> bits<span class="token punctuation">)</span>                  <span class="token operator">|</span>       <span class="token class-name">State</span>        <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span> hashcode<span class="token operator">:</span><span class="token number">25</span> <span class="token operator">|</span> age<span class="token operator">:</span><span class="token number">4</span> <span class="token operator">|</span> biased_lock<span class="token operator">:</span><span class="token number">0</span> 		     <span class="token operator">|</span> <span class="token number">01</span> 	<span class="token operator">|</span>       <span class="token class-name">Normal</span>       <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>  threadID<span class="token operator">:</span><span class="token number">23</span> <span class="token operator">|</span> epoch<span class="token operator">:</span><span class="token number">2</span> <span class="token operator">|</span> age<span class="token operator">:</span><span class="token number">4</span> <span class="token operator">|</span> biased_lock<span class="token operator">:</span><span class="token number">1</span> <span class="token operator">|</span> <span class="token number">01</span> 	<span class="token operator">|</span>       <span class="token class-name">Biased</span>       <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>               ptr_to_lock_record<span class="token operator">:</span><span class="token number">30</span>            <span class="token operator">|</span> <span class="token number">00</span> 	<span class="token operator">|</span> <span class="token class-name">Lightweight</span> <span class="token class-name">Locked</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>               ptr_to_heavyweight_monitor<span class="token operator">:</span><span class="token number">30</span>    <span class="token operator">|</span> <span class="token number">10</span> 	<span class="token operator">|</span> <span class="token class-name">Heavyweight</span> <span class="token class-name">Locked</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
<span class="token operator">|</span>                                                <span class="token operator">|</span> <span class="token number">11</span> 	<span class="token operator">|</span>    <span class="token class-name">Marked</span> <span class="token keyword">for</span> <span class="token constant">GC</span>   <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">|</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">|</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åå‘é”ï¼ˆBiasedï¼‰ï¼š<code>MarkWord</code>å­˜å‚¨çš„æ˜¯åå‘çš„çº¿ç¨‹ID</li><li>è½»é‡é”ï¼š<code>MarkWord</code>å­˜å‚¨çš„æ˜¯æŒ‡å‘çº¿ç¨‹æ ˆä¸­<code>Lock Record</code>çš„æŒ‡é’ˆ</li><li>é‡é‡é”ï¼š<code>MarkWord</code>å­˜å‚¨çš„æ˜¯æŒ‡å‘å †ä¸­çš„<code>monitor</code>å¯¹è±¡ï¼ˆç³»ç»Ÿäº’æ–¥é‡æŒ‡é’ˆï¼‰</li></ul><h3 id="_2-3-0-æ— é”-001" tabindex="-1"><a class="header-anchor" href="#_2-3-0-æ— é”-001" aria-hidden="true">#</a> 2.3.0 æ— é”ï¼ˆ001ï¼‰</h3><p>å‚è§ï¼š<strong>2.1.2 ä»Javaå¯¹è±¡çœ‹ Mark Word</strong></p><h3 id="_2-3-1-åå‘é”-101" tabindex="-1"><a class="header-anchor" href="#_2-3-1-åå‘é”-101" aria-hidden="true">#</a> 2.3.1 åå‘é”ï¼ˆ101ï¼‰</h3><p>åå‘é”çš„æ€æƒ³æ˜¯åå‘äºè®©<strong>ç¬¬ä¸€ä¸ªè·å–é”å¯¹è±¡çš„çº¿ç¨‹</strong>ï¼Œè¿™ä¸ªçº¿ç¨‹ä¹‹å<strong>é‡æ–°è·å–è¯¥é”ä¸å†éœ€è¦åŒæ­¥</strong>æ“ä½œï¼š</p><ul><li>å½“é”å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«çº¿ç¨‹è·å¾—çš„æ—¶å€™è¿›å…¥åå‘çŠ¶æ€ï¼Œæ ‡è®°ä¸º 101ï¼ŒåŒæ—¶<strong>ä½¿ç”¨ CAS æ“ä½œå°†çº¿ç¨‹ ID è®°å½•åˆ° Mark Word</strong>ã€‚å¦‚æœ CAS æ“ä½œæˆåŠŸï¼Œè¿™ä¸ªçº¿ç¨‹ä»¥åè¿›å…¥è¿™ä¸ªé”ç›¸å…³çš„åŒæ­¥å—ï¼ŒæŸ¥çœ‹è¿™ä¸ªçº¿ç¨‹ ID æ˜¯è‡ªå·±çš„å°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œå°±ä¸éœ€è¦å†è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œ</li><li>å½“æœ‰å¦å¤–ä¸€ä¸ªçº¿ç¨‹å»å°è¯•è·å–è¿™ä¸ªé”å¯¹è±¡æ—¶ï¼Œåå‘çŠ¶æ€å°±å®£å‘Šç»“æŸï¼Œæ­¤æ—¶æ’¤é”€åå‘ï¼ˆRevoke Biasï¼‰åæ¢å¤åˆ°æœªé”å®šæˆ–è½»é‡çº§é”çŠ¶æ€</li></ul><p>åå‘é”ï¼š<strong>å•çº¿ç¨‹ç«äº‰</strong>ï¼Œå½“çº¿ç¨‹Aç¬¬ä¸€æ¬¡ç«äº‰åˆ°é”æ—¶ï¼Œé€šè¿‡ä¿®æ”¹<code>MarkWord</code>ä¸­çš„åå‘çº¿ç¨‹IDã€åå‘æ¨¡å¼ã€‚<strong>å¦‚æœä¸å­˜åœ¨å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œé‚£ä¹ˆæŒæœ‰åå‘é”çš„çº¿ç¨‹å°†æ°¸è¿œä¸éœ€è¦è¿›è¡ŒåŒæ­¥</strong>ã€‚</p><p>ç†è®ºè½åœ°ï¼š</p><figure><img src="/my-docs/assets/1681451836192-5ae30f1e-085d-4c2b-aa8c-1bd47f199116-e9e6b47a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æŠ€æœ¯å®ç°ï¼š</p><figure><img src="/my-docs/assets/1681451914425-01aa0721-8f56-4413-a1db-5092fcbfdf06-7725c34a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æœ‰å…³åå‘é”çš„å‘½ä»¤ï¼š</p><figure><img src="/my-docs/assets/1681452242110-e3b8e768-acfb-4f43-9a50-8699e9952ece-62fc2a9e.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>æ¡ˆä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">BiasedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
         * è¿™é‡Œåå‘é”åœ¨JDK6ä»¥ä¸Šé»˜è®¤å¼€å¯ï¼Œå¼€å¯åç¨‹åºå¯åŠ¨4ç§’åæ‰ä¼šè¢«æ¿€æ´»ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°æ¥å…³é—­å»¶è¿Ÿ
         * å¼€å¯åå‘é”ï¼š     -XX:+UseBiasedLocking
         * å…³é—­åå‘é”çš„å»¶è¿Ÿ  -XX:BiasedLockingStartupDelay=0
    */</span>
    <span class="token comment">//        try { TimeUnit.SECONDS.sleep(5); } catch (InterruptedException e) { e.printStackTrace(); }</span>
    <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœï¼š</p><figure><img src="/my-docs/assets/image-20230628134138026-7aed4271.png" alt="image-20230628134138026" tabindex="0" loading="lazy"><figcaption>image-20230628134138026</figcaption></figure><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹<code>JVM</code>ç›¸å…³å‚æ•°çš„é»˜è®¤å€¼ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">java</span> <span class="token parameter variable">-XX:+PrintFlagsInitial</span> <span class="token operator">|</span> <span class="token function">grep</span> BiasedLock*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="/my-docs/assets/image-20230628135649096-2034af15.png" alt="image-20230628135649096" tabindex="0" loading="lazy"><figcaption>image-20230628135649096</figcaption></figure><blockquote><p>æ³¨æ„ï¼š</p><p>ç”±äºåå‘é”å¯åŠ¨æœ‰å»¶è¿Ÿï¼Œæ•…è€Œä¸åŠ å…¥ <code>-XX:BiasedLockingStartupDelay=0</code> å‚æ•°æˆ–è€… <code>TimeUnit.SECONDS.sleep(5);</code>ã€‚ä¸Šè¿°ä»£ç ä¼šç›´æ¥è¿›å…¥è½»é‡çº§é”çš„çŠ¶æ€**ï¼ˆé”æ ‡å¿—ä½ï¼š00ï¼‰<strong>ï¼Œè€Œä¸æ˜¯åå‘é”</strong>ï¼ˆåå‘é”ä½+é”æ ‡å¿—ä½ï¼š101ï¼‰**ã€‚</p><p>ç”±äºç»´æŠ¤æˆæœ¬è¿‡é«˜ï¼Œåœ¨<strong>JDK15</strong>ä»¥åä¼šé€æ­¥åºŸå¼ƒåå‘é”ã€‚</p></blockquote><h3 id="_2-3-2-è½»é‡çº§é”-00" tabindex="-1"><a class="header-anchor" href="#_2-3-2-è½»é‡çº§é”-00" aria-hidden="true">#</a> 2.3.2 è½»é‡çº§é”ï¼ˆ00ï¼‰</h3><p>æ¦‚å¿µï¼šå¤šçº¿ç¨‹ç«äº‰ï¼Œä½†æ˜¯ä»»æ„æ—¶å€™<strong>æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹ç«äº‰</strong>ï¼Œå³<strong>ä¸å­˜åœ¨é”ç«äº‰å¤ªæ¿€çƒˆçš„æƒ…å†µ</strong>ï¼Œä¹Ÿå°±æ²¡æœ‰çº¿ç¨‹é˜»å¡ã€‚</p><p>ä¸»è¦ä½œç”¨ï¼šæœ‰çº¿ç¨‹æ¥å‚ä¸é”çš„ç«äº‰ï¼Œä½†æ˜¯è·å–é”çš„å†²çªæ—¶é—´æçŸ­ï¼Œæœ¬è´¨æ˜¯è‡ªæ—‹é”CASã€‚</p><figure><img src="/my-docs/assets/1681454510407-cde9df3c-e7ed-415f-a459-76f64160035f-d2d0bc1f.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>è½»é‡é”çš„è·å–ï¼š</p><figure><img src="/my-docs/assets/1681454665890-db296f20-69b8-4bd8-8538-0197584c61e5-74b7856f.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="è½»é‡çº§é”çš„åŠ é”ä¸é‡Šæ”¾" tabindex="-1"><a class="header-anchor" href="#è½»é‡çº§é”çš„åŠ é”ä¸é‡Šæ”¾" aria-hidden="true">#</a> è½»é‡çº§é”çš„åŠ é”ä¸é‡Šæ”¾</h4><p><strong>è½»é‡çº§é”çš„åŠ é”</strong></p><p><code>JVM</code>ä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­åˆ›å»ºç”¨äºå­˜å‚¨é”è®°å½•çš„ç©ºé—´ï¼Œå®˜æ–¹ç§°ä¸º<code>Displaced Mark Word</code>ã€‚è‹¥ä¸€ä¸ªçº¿ç¨‹è·å¾—é”æ—¶å‘ç°æ˜¯è½»é‡çº§é”ï¼Œä¼šæŠŠé”çš„<code>MarkWord</code>å¤åˆ¶åˆ°è‡ªå·±çš„<code>Displaced Mark Word</code>é‡Œé¢ã€‚ç„¶åçº¿ç¨‹å°è¯•ç”¨<code>CAS</code>å°†é”çš„<code>MarkWord</code>æ›¿æ¢ä¸º<strong>æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆ</strong>ã€‚å¦‚æœæˆåŠŸï¼Œå½“å‰çº¿ç¨‹è·å¾—é”ï¼Œå¦‚æœå¤±è´¥ï¼Œè¡¨ç¤ºMark Wordå·²ç»è¢«æ›¿æ¢æˆäº†å…¶ä»–çº¿ç¨‹çš„é”è®°å½•ï¼Œè¯´æ˜åœ¨ä¸å…¶å®ƒçº¿ç¨‹ç«äº‰é”ï¼Œå½“å‰çº¿ç¨‹å°±å°è¯•ä½¿ç”¨è‡ªæ—‹æ¥è·å–é”ã€‚</p><p>è‡ªæ—‹CASï¼šä¸æ–­å°è¯•å»è·å–é”ï¼Œèƒ½ä¸å‡çº§å°±ä¸å‡çº§ï¼Œå°½é‡ä¸è¦é˜»å¯¨ã€‚</p><p><strong>è½»é‡çº§é”çš„é‡Šæ”¾</strong></p><p>åœ¨é‡Šæ”¾é”æ—¶ï¼Œå½“å‰çº¿ç¨‹ä¼šä½¿ç”¨<code>CAS</code>æ“ä½œå°†<code>Displaced Mark Word</code>çš„å†…å®¹å¤åˆ¶å›é”çš„Mark Wordé‡Œé¢ã€‚å¦‚æœæ²¡æœ‰å‘ç”Ÿç«äº‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶çš„æ“ä½œä¼šæˆåŠŸã€‚å¦‚æœæœ‰å…¶ä»–çº¿ç¨‹å› ä¸ºè‡ªæ—‹å¤šæ¬¡å¯¼è‡´è½»é‡çº§é”å‡çº§æˆäº†é‡é‡çº§é”ï¼Œé‚£ä¹ˆ<code>CAS</code>æ“ä½œä¼šå¤±è´¥ï¼Œæ­¤æ—¶ä¼šé‡Šæ”¾é”å¹¶å”¤é†’è¢«é˜»å¯¨çš„çº¿ç¨‹ã€‚</p><h4 id="è‡ªæ—‹é”çš„æ¬¡æ•°" tabindex="-1"><a class="header-anchor" href="#è‡ªæ—‹é”çš„æ¬¡æ•°" aria-hidden="true">#</a> è‡ªæ—‹é”çš„æ¬¡æ•°</h4><p><strong>java6ä¹‹å‰</strong></p><figure><img src="/my-docs/assets/019bb3b645bb406a89f7469cab952f07-39554365.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><p><strong>java6ä¹‹å</strong></p><p>è‡ªé€‚åº”è‡ªé€‰é”ï¼šçº¿ç¨‹å¦‚æœè‡ªæ—‹æˆåŠŸäº†ï¼Œé‚£ä¸‹æ¬¡è‡ªæ—‹çš„æœ€å¤§æ¬¡æ•°ä¼šå¢åŠ ï¼Œå› ä¸º<code>JVM</code>è®¤ä¸ºæ—¢ç„¶ä¸Šæ¬¡æˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡ä¹Ÿå¾ˆå¤§æ¦‚ç‡ä¼šæˆåŠŸã€‚å¦‚æœå¾ˆå°‘ä¼šè‡ªæ—‹æˆåŠŸï¼Œé‚£ä¹ˆä¸‹æ¬¡ä¼šå‡å°‘è‡ªæ—‹çš„æ¬¡æ•°ç”šè‡³ä¸è‡ªæ—‹ï¼Œé¿å…CPUç©ºè½¬ã€‚</p><h4 id="è½»é‡é”å’Œåå‘é”çš„åŒºåˆ«å’Œä¸åŒ" tabindex="-1"><a class="header-anchor" href="#è½»é‡é”å’Œåå‘é”çš„åŒºåˆ«å’Œä¸åŒ" aria-hidden="true">#</a> è½»é‡é”å’Œåå‘é”çš„åŒºåˆ«å’Œä¸åŒ</h4><ul><li>äº‰å¤ºè½»é‡çº§é”å¤±è´¥æ—¶ï¼Œè‡ªæ—‹å°è¯•æŠ¢å é”</li><li>è½»é‡çº§é”æ¯æ¬¡é€€å‡ºåŒæ­¥å—éƒ½éœ€è¦é‡Šæ”¾é”ï¼Œè€Œåå‘é”æ˜¯åœ¨ç«äº‰å‘ç”Ÿæ—¶æ‰é‡Šæ”¾é”</li></ul><h3 id="_2-3-3-é‡é‡çº§é”-10" tabindex="-1"><a class="header-anchor" href="#_2-3-3-é‡é‡çº§é”-10" aria-hidden="true">#</a> 2.3.3 é‡é‡çº§é”ï¼ˆ10ï¼‰</h3><figure><img src="/my-docs/assets/896a934c809740a68c5e18ec7374f100-cd3f720d.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure><p>æœ‰å¤§é‡çš„çº¿ç¨‹å‚ä¸é”çš„ç«äº‰ï¼Œå†²çªæ€§å¾ˆé«˜ã€‚</p><p>Javaä¸­synchronizedçš„é‡é‡çº§é”ï¼Œæ˜¯åŸºäºè¿›å…¥å’Œé€€å‡º<code>Monitor</code>å¯¹è±¡å®ç°çš„ã€‚åœ¨ç¼–è¯‘æ—¶ä¼šå°†åŒæ­¥å—çš„å¼€å§‹ä½ç½®æ’å…¥<code>monitorenter</code>æŒ‡ä»¤ï¼Œåœ¨ç»“æŸä½ç½®æ’å…¥<code>monitorexit</code>æŒ‡ä»¤ã€‚</p><p>å½“çº¿ç¨‹æ‰§è¡Œåˆ°<code>monitorenter</code>æŒ‡ä»¤æ—¶ï¼Œä¼šå°è¯•è·å–å¯¹è±¡æ‰€å¯¹åº”çš„<code>Monitor</code>æ‰€æœ‰æƒï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œå³è·å–åˆ°äº†é”ï¼Œä¼šåœ¨<code>Monitor</code>çš„<code>owner</code>ä¸­å­˜æ”¾<strong>å½“å‰çº¿ç¨‹çš„id</strong>ï¼Œè¿™æ ·å®ƒå°†å¤„äºé”å®šçŠ¶æ€ï¼Œé™¤éé€€å‡ºåŒæ­¥å—ï¼Œå¦åˆ™å…¶ä»–çº¿ç¨‹æ— æ³•è·å–åˆ°è¿™ä¸ª<code>Monitor</code>ã€‚</p><h3 id="_2-3-4-å°æ€»ç»“-é¢è¯•ä¸­çš„é«˜é¢‘è€ƒç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-3-4-å°æ€»ç»“-é¢è¯•ä¸­çš„é«˜é¢‘è€ƒç‚¹" aria-hidden="true">#</a> 2.3.4 å°æ€»ç»“-é¢è¯•ä¸­çš„é«˜é¢‘è€ƒç‚¹</h3><p><strong>é”å‡çº§å‘ç”Ÿåï¼Œhashcodeå»å“ªå•¦</strong></p><p>é”å‡çº§ä¸ºè½»é‡çº§æˆ–é‡é‡çº§é”åï¼ŒMark Wordä¸­ä¿å­˜çš„åˆ†åˆ«æ˜¯çº¿ç¨‹æ ˆå¸§é‡Œçš„é”è®°å½•æŒ‡é’ˆå’Œé‡é‡çº§é”æŒ‡é’ˆï¼Œå·±ç»æ²¡æœ‰ä½ç½®å†ä¿å­˜å“ˆå¸Œç ï¼ŒGCå¹´é¾„äº†ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯è¢«ç§»åŠ¨åˆ°å“ªé‡Œå»äº†å‘¢ï¼Ÿ</p><p>ä¸‹é¢æè¿°æ¥æºäºï¼šã€Šæ·±åº¦ç†è§£Javaè™šæ‹Ÿæœºã€‹ç¬¬ä¸‰ç‰ˆã€‚</p><figure><img src="/my-docs/assets/image-20230628145143475-c83fe108.png" alt="image-20230628145143475" tabindex="0" loading="lazy"><figcaption>image-20230628145143475</figcaption></figure><blockquote><p>è®¡ç®—è¿‡å“ˆå¸Œçš„å¯¹è±¡ï¼Œæ— æ³•åœ¨è¿›å…¥åå‘é”çŠ¶æ€ã€‚</p><p>å¤„äºåå‘é”çš„å¯¹è±¡ï¼Œå½“éœ€è¦è®¡ç®—å“ˆå¸Œæ—¶ï¼Œè¯¥å¯¹è±¡çš„åå‘çŠ¶æ€ä¼šè¢«æ’¤é”€ï¼Œå‡çº§ä¸ºé‡é‡çº§é”ã€‚è€Œé‡é‡çº§é”å¯¹åº”<code>ObjectMonitor</code>å¯¹è±¡æœ‰å­—æ®µè®°å½•é”å¯¹è±¡çš„<code>Markword</code> ï¼Œè‡ªç„¶ä¹Ÿå°±å¯ä»¥å­˜å‚¨<code>hashcode</code></p></blockquote><p>ä»£ç éªŒè¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">BiasedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
         * è¿™é‡Œåå‘é”åœ¨JDK6ä»¥ä¸Šé»˜è®¤å¼€å¯ï¼Œå¼€å¯åç¨‹åºå¯åŠ¨å‡ ç§’åæ‰ä¼šè¢«æ¿€æ´»ï¼Œå¯ä»¥é€šè¿‡JVMå‚æ•°æ¥å…³é—­å»¶è¿Ÿ
         * å¼€å¯åå‘é”ï¼š     -XX:+UseBiasedLocking
         * å…³é—­åå‘é”çš„å»¶è¿Ÿ  -XX:BiasedLockingStartupDelay=0
         */</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span> e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸è¿›è¡Œhashè®¡ç®—&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//        æƒ…å†µä¸€ï¼šè¿›è¡Œhashcodeè®¡ç®—ï¼Œå¯¹è±¡æ— æ³•è¿›å…¥åå‘é”çŠ¶æ€ã€‚</span>
    <span class="token class-name">Object</span> o2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æƒ…å†µä¸€ï¼šæ²¡æœ‰å–å¾—é”ï¼Œè¿›è¡Œhashcodeè®¡ç®—ï¼Œå¯¹è±¡æ— æ³•è¿›å…¥åå‘é”çŠ¶æ€ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—hashcode</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o2<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// å› ä¸ºo2è®¡ç®—è¿‡hashcodeï¼Œæ•…è€Œä¼šç›´æ¥è¿›å…¥è½»é‡çº§é”ã€‚</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/*
         æƒ…å†µäºŒï¼šå–å¾—åå‘é”åï¼Œè¿›è¡Œhashcodeè®¡ç®—ã€‚å¯¹è±¡ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚
         */</span>
    <span class="token class-name">Object</span> o3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æƒ…å†µäºŒï¼šå–å¾—åå‘é”åï¼Œè¿›è¡Œhashcodeè®¡ç®—ã€‚å¯¹è±¡ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o3<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// å› ä¸ºo2è®¡ç®—è¿‡hashcodeï¼Œæ•…è€Œä¼šç›´æ¥è¿›å…¥è½»é‡çº§é”ã€‚</span>
        <span class="token comment">//            è®¡ç®—hashä¹‹å‰</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è®¡ç®—hashä¹‹å‰&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o3<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è®¡ç®—hashä¹‹å&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>o3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœï¼šé€šè¿‡é”æ ‡è®°ä½ç½®ï¼Œå¯ä»¥å‘ç°é”çš„å˜åŒ–è¿‡ç¨‹ã€‚</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>å¼€å§‹
ä¸è¿›è¡Œhashè®¡ç®—
java.lang.Object object internals:
 OFFSET  SIZE   TYPE DESCRIPTION                               VALUE
      0     4        (object header)                           05 c8 88 00 (00000101 11001000 10001000 00000000) (8964101)
      4     4        (object header)                           dd 01 00 00 (11011101 00000001 00000000 00000000) (477)
      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)
     12     4        (loss due to the next object alignment)
Instance size: 16 bytes
Space losses: 0 bytes internal + 4 bytes external = 4 bytes total

æƒ…å†µä¸€ï¼šæ²¡æœ‰å–å¾—é”ï¼Œè¿›è¡Œhashcodeè®¡ç®—ï¼Œå¯¹è±¡æ— æ³•è¿›å…¥åå‘é”çŠ¶æ€ã€‚
1724731843
java.lang.Object object internals:
 OFFSET  SIZE   TYPE DESCRIPTION                               VALUE
      0     4        (object header)                           e8 f6 cf 38 (11101000 11110110 11001111 00111000) (953153256)
      4     4        (object header)                           cd 00 00 00 (11001101 00000000 00000000 00000000) (205)
      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)
     12     4        (loss due to the next object alignment)
Instance size: 16 bytes
Space losses: 0 bytes internal + 4 bytes external = 4 bytes total

æƒ…å†µäºŒï¼šå–å¾—åå‘é”åï¼Œè¿›è¡Œhashcodeè®¡ç®—ã€‚å¯¹è±¡ä¼šå‡çº§ä¸ºé‡é‡çº§é”ã€‚
è®¡ç®—hashä¹‹å‰
java.lang.Object object internals:
 OFFSET  SIZE   TYPE DESCRIPTION                               VALUE
      0     4        (object header)                           05 c8 88 00 (00000101 11001000 10001000 00000000) (8964101)
      4     4        (object header)                           dd 01 00 00 (11011101 00000001 00000000 00000000) (477)
      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)
     12     4        (loss due to the next object alignment)
Instance size: 16 bytes
Space losses: 0 bytes internal + 4 bytes external = 4 bytes total

1305193908
è®¡ç®—hashä¹‹å
java.lang.Object object internals:
 OFFSET  SIZE   TYPE DESCRIPTION                               VALUE
      0     4        (object header)                           da fc 78 24 (11011010 11111100 01111000 00100100) (611908826)
      4     4        (object header)                           dd 01 00 00 (11011101 00000001 00000000 00000000) (477)
      8     4        (object header)                           e5 01 00 f8 (11100101 00000001 00000000 11111000) (-134217243)
     12     4        (loss due to the next object alignment)
Instance size: 16 bytes
Space losses: 0 bytes internal + 4 bytes external = 4 bytes total

ç»“æŸ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-4-å…¬å¹³é”ä¸éå…¬å¹³é”" tabindex="-1"><a class="header-anchor" href="#_2-4-å…¬å¹³é”ä¸éå…¬å¹³é”" aria-hidden="true">#</a> 2.4 å…¬å¹³é”ä¸éå…¬å¹³é”</h2><ul><li>å…¬å¹³é”ï¼šæ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œè¿™é‡Œç±»ä¼¼äºæ’é˜Ÿä¹°ç¥¨ï¼Œå…ˆæ¥çš„äººå…ˆä¹°ï¼Œåæ¥çš„äººå†é˜Ÿå°¾æ’ç€ï¼Œè¿™æ˜¯å…¬å¹³çš„ã€‚ä¾‹å¦‚ï¼š<code>Lock lock = new ReentrantLock(true)</code> è¡¨ç¤ºå…¬å¹³é”ï¼Œå…ˆæ¥å…ˆå¾—ã€‚</li><li>éå…¬å¹³é”ï¼šæ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ï¼Œåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œæœ‰å¯èƒ½é€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿çš„çŠ¶æ€ï¼ˆæŸä¸ªçº¿ç¨‹ä¸€ç›´å¾—ä¸åˆ°é”ï¼‰ã€‚ä¾‹å¦‚ï¼š<code>Lock lock = new ReentrantLock(true)</code>è¡¨ç¤ºéå…¬å¹³é”ï¼Œåæ¥çš„ä¹Ÿå¯èƒ½å…ˆè·å¾—é”ï¼Œ<strong>é»˜è®¤ä¸ºéå…¬å¹³é”</strong>ã€‚</li></ul><h3 id="_2-4-1-ä¸ºä»€ä¹ˆè¦æœ‰å…¬å¹³é”ä¸éå…¬å¹³é”" tabindex="-1"><a class="header-anchor" href="#_2-4-1-ä¸ºä»€ä¹ˆè¦æœ‰å…¬å¹³é”ä¸éå…¬å¹³é”" aria-hidden="true">#</a> 2.4.1 ä¸ºä»€ä¹ˆè¦æœ‰å…¬å¹³é”ä¸éå…¬å¹³é”ï¼Ÿ</h3><p>ç­”ï¼šå…¬å¹³ä¸éå…¬å¹³å„æœ‰ä¼˜åŠ£ï¼Œæ›´å…·ä¸åŒçš„æƒ…å†µä½¿ç”¨ä¸åŒçš„é”ã€‚å¦‚æœä¸ºäº†æ›´é«˜çš„ååé‡ï¼Œå¾ˆæ˜¾ç„¶éå…¬å¹³é”æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œå› ä¸ºèŠ‚çœäº†å¾ˆå¤šçº¿ç¨‹åˆ‡æ¢çš„æ—¶é—´ï¼Œååé‡è‡ªç„¶å°±ä¸Šå»äº†ï¼›å¦åˆ™å°±ç”¨å…¬å¹³é”ï¼Œå¤§å®¶å…¬å¹³ä½¿ç”¨ã€‚</p><p>éå…¬å¹³é”èƒ½æ›´å……åˆ†åœ°åˆ©ç”¨CPUçš„æ—¶é—´ç‰‡ï¼Œå°½é‡å‡å°‘CPUç©ºé—´çŠ¶æ€æ—¶é—´ã€‚</p><h3 id="_2-4-2-ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯éå…¬å¹³çš„" tabindex="-1"><a class="header-anchor" href="#_2-4-2-ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯éå…¬å¹³çš„" aria-hidden="true">#</a> 2.4.2 ä¸ºä»€ä¹ˆé»˜è®¤æ˜¯éå…¬å¹³çš„ï¼Ÿ</h3><p>ä½¿ç”¨å¤šçº¿ç¨‹å¾ˆé‡è¦çš„è€ƒé‡ç‚¹æ˜¯<strong>çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€</strong>ï¼Œå½“é‡‡ç”¨<strong>éå…¬å¹³é”æ—¶</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚é”è·å–åŒæ­¥çŠ¶æ€ï¼Œç„¶åé‡Šæ”¾åŒæ­¥çŠ¶æ€ï¼Œæ‰€ä»¥åˆšé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨æ­¤åˆ»å†æ¬¡è·å–åŒæ­¥çŠ¶æ€çš„æ¦‚ç‡å°±å˜å¾—å¾ˆå¤§ï¼Œæ‰€ä»¥å°±å‡å°‘äº†çº¿ç¨‹çš„å¼€é”€ã€‚</p><h2 id="_2-5-å„ç§é”çš„ä¼˜ç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-5-å„ç§é”çš„ä¼˜ç¼ºç‚¹" aria-hidden="true">#</a> 2.5 å„ç§é”çš„ä¼˜ç¼ºç‚¹</h2><figure><img src="/my-docs/assets/033991889cf943b181c8314663a14545-029fd480.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><figure><img src="/my-docs/assets/14230e2472c948318addb902e909a4c8-b028db3a.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h1 id="_3ã€jitç¼–è¯‘å™¨å¯¹é”çš„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3ã€jitç¼–è¯‘å™¨å¯¹é”çš„ä¼˜åŒ–" aria-hidden="true">#</a> 3ã€JITç¼–è¯‘å™¨å¯¹é”çš„ä¼˜åŒ–</h1><h2 id="_3-1-é”æ¶ˆé™¤" tabindex="-1"><a class="header-anchor" href="#_3-1-é”æ¶ˆé™¤" aria-hidden="true">#</a> 3.1 é”æ¶ˆé™¤</h2><p>æ¯æ¬¡çš„é”å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæ— æ³•è¾¾åˆ°åŒæ­¥çš„æ•ˆæœã€‚åœ¨ç¼–è¯‘æ—¶æœŸä¼šå¿½ç•¥è¯¥åŒæ­¥ä»£ç å—ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">m1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//é”æ¶ˆé™¤é—®é¢˜ï¼ŒJITä¼šæ— è§†å®ƒï¼Œsynchronized(o)æ¯æ¬¡newå‡ºæ¥çš„ï¼Œéƒ½ä¸å­˜åœ¨äº†ï¼Œéæ­£å¸¸çš„</span>
    <span class="token class-name">Object</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;-----------hello LockClearUpDemo&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\t&quot;</span> <span class="token operator">+</span> object<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-2-é”ç²—åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-2-é”ç²—åŒ–" aria-hidden="true">#</a> 3.2 é”ç²—åŒ–</h2><p>åŒä¸€ä¸ªå¯¹è±¡é”ï¼Œåˆå¹¶ä¸ºç»Ÿä¸€çš„åŒæ­¥ä»£ç å—ï¼Œé¿å…é‡å¤çš„åŠ é”é‡Šæ”¾é”çš„æ“ä½œã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;111111111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;222222222222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;333333333333&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;444444444444&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//åº•å±‚JITçš„é”ç²—åŒ–ä¼˜åŒ–</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>objectLock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;111111111111&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;222222222222&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;333333333333&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;444444444444&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_4-é”çš„æ´»è·ƒæ€§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_4-é”çš„æ´»è·ƒæ€§é—®é¢˜" aria-hidden="true">#</a> 4.é”çš„æ´»è·ƒæ€§é—®é¢˜</h1><h2 id="_4-1-å“²å­¦å®¶å°±é¤é—®é¢˜-æ­»é”" tabindex="-1"><a class="header-anchor" href="#_4-1-å“²å­¦å®¶å°±é¤é—®é¢˜-æ­»é”" aria-hidden="true">#</a> 4.1 å“²å­¦å®¶å°±é¤é—®é¢˜-æ­»é”</h2><figure><img src="/my-docs/assets/1649491894753-aa488041-13c1-45a6-a994-154a0aaccf6d-54771714.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>æœ‰äº”ä½å“²å­¦å®¶ï¼Œå›´ååœ¨åœ†æ¡Œæ—ã€‚</p><ul><li>ä»–ä»¬åªåšä¸¤ä»¶äº‹ï¼Œæ€è€ƒå’Œåƒé¥­ï¼Œæ€è€ƒä¸€ä¼šåƒå£é¥­ï¼Œåƒå®Œé¥­åæ¥ç€æ€è€ƒã€‚</li><li>åƒé¥­æ—¶è¦ç”¨ä¸¤æ ¹ç­·å­åƒï¼Œæ¡Œä¸Šå…±æœ‰ 5 æ ¹ç­·å­ï¼Œæ¯ä½å“²å­¦å®¶å·¦å³æ‰‹è¾¹å„æœ‰ä¸€æ ¹ç­·å­ã€‚</li><li>å¦‚æœç­·å­è¢«èº«è¾¹çš„äººæ‹¿ç€ï¼Œè‡ªå·±å°±å¾—ç­‰å¾…</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">chapter02</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">utils<span class="token punctuation">.</span></span><span class="token class-name">Sleeper</span></span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">App</span><span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Chopstick</span> c1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Chopstick</span> c5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token string">&quot;5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Philosophers</span><span class="token punctuation">(</span><span class="token string">&quot;å­”å­&quot;</span><span class="token punctuation">,</span>c1<span class="token punctuation">,</span>c2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosophers</span><span class="token punctuation">(</span><span class="token string">&quot;å­Ÿå­&quot;</span><span class="token punctuation">,</span>c2<span class="token punctuation">,</span>c3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosophers</span><span class="token punctuation">(</span><span class="token string">&quot;å¢¨å­&quot;</span><span class="token punctuation">,</span>c3<span class="token punctuation">,</span>c4<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosophers</span><span class="token punctuation">(</span><span class="token string">&quot;åº„å­&quot;</span><span class="token punctuation">,</span>c4<span class="token punctuation">,</span>c5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Philosophers</span><span class="token punctuation">(</span><span class="token string">&quot;ç‹é˜³æ˜&quot;</span><span class="token punctuation">,</span>c5<span class="token punctuation">,</span>c1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * å“²å­¦å®¶å°±é¤é—®é¢˜
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Philosophers</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Philosophers</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Chopstick</span> left<span class="token punctuation">;</span>
    <span class="token class-name">Chopstick</span> right<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Philosophers</span><span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> left<span class="token punctuation">,</span> <span class="token class-name">Chopstick</span> right<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">=</span> left<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>right <span class="token operator">=</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;eating......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å¾—å·¦æ‰‹ç­·å­</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·å¾—å³æ‰‹ç­·å­</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>right<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// åƒé¥­</span>
                    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// æ”¾ä¸‹å³æ‰‹ç­·å­</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// æ”¾ä¸‹å·¦æ‰‹ç­·å­</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç­·å­ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Chopstick</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Chopstick</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;ç­·å­{&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-2-æ´»é”" tabindex="-1"><a class="header-anchor" href="#_4-2-æ´»é”" aria-hidden="true">#</a> 4.2 æ´»é”</h2><p>æ´»é”å‡ºç°åœ¨ä¸¤ä¸ªçº¿ç¨‹äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶ï¼Œæœ€åè°ä¹Ÿæ— æ³•ç»“æŸï¼Œä¾‹å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestLiveLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æœŸæœ›å‡åˆ° 0 é€€å‡ºå¾ªç¯</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                count<span class="token operator">--</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count: {}&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æœŸæœ›è¶…è¿‡ 20 é€€å‡ºå¾ªç¯</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;count: {}&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-3-é¥¥é¥¿" tabindex="-1"><a class="header-anchor" href="#_4-3-é¥¥é¥¿" aria-hidden="true">#</a> 4.3 é¥¥é¥¿</h2><p>å¾ˆå¤šæ•™ç¨‹ä¸­æŠŠé¥¥é¥¿å®šä¹‰ä¸ºï¼Œä¸€ä¸ªçº¿ç¨‹ç”±äº<strong>ä¼˜å…ˆçº§å¤ªä½</strong>ï¼Œå§‹ç»ˆå¾—ä¸åˆ° CPU è°ƒåº¦æ‰§è¡Œï¼Œä¹Ÿä¸èƒ½å¤Ÿç»“æŸï¼Œé¥¥é¥¿çš„æƒ…å†µä¸æ˜“æ¼”ç¤ºï¼Œè®²è¯»å†™é”æ—¶ä¼šæ¶‰åŠé¥¥é¥¿é—®é¢˜ã€‚</p><h2 id="_4-4-reentrantlock" tabindex="-1"><a class="header-anchor" href="#_4-4-reentrantlock" aria-hidden="true">#</a> 4.4 ReentrantLock</h2><p>ç›¸å¯¹äº synchronized å®ƒå…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹</p><ul><li>å¯ä¸­æ–­</li><li>å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´</li><li>å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”</li><li>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡</li></ul><p>ä¸ synchronized ä¸€æ ·ï¼Œéƒ½æ”¯æŒå¯é‡å…¥</p><p>åŸºæœ¬è¯­æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// è·å–é”</span>
reentrantLock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä¸´ç•ŒåŒº</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">// é‡Šæ”¾é”</span>
    reentrantLock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯é‡å…¥" tabindex="-1"><a class="header-anchor" href="#å¯é‡å…¥" aria-hidden="true">#</a> å¯é‡å…¥</h3><p>å¯é‡å…¥æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¦‚æœé¦–æ¬¡è·å¾—äº†è¿™æŠŠé”ï¼Œé‚£ä¹ˆå› ä¸ºå®ƒæ˜¯è¿™æŠŠé”çš„æ‹¥æœ‰è€…ï¼Œå› æ­¤æœ‰æƒåˆ©å†æ¬¡è·å–è¿™æŠŠé”</p><p>å¦‚æœæ˜¯ä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡è·å¾—é”æ—¶ï¼Œè‡ªå·±ä¹Ÿä¼šè¢«é”æŒ¡ä½</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execute method1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execute method2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">method3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;execute method3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºï¼š</p><div class="language-cmd line-numbers-mode" data-ext="cmd"><pre class="language-cmd"><code>17:59:11.862 [main] c.TestReentrant - execute method1 
17:59:11.865 [main] c.TestReentrant - execute method2 
17:59:11.865 [main] c.TestReentrant - execute method3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯æ‰“æ–­-lock-lockinterruptibly" tabindex="-1"><a class="header-anchor" href="#å¯æ‰“æ–­-lock-lockinterruptibly" aria-hidden="true">#</a> å¯æ‰“æ–­ lock.lockInterruptibly()</h3><p>ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">//æ²¡æœ‰ç«äº‰å°±ä¼šè·å–é”</span>
        <span class="token comment">//æœ‰ç«äº‰å°±è¿›å…¥é˜»å¡é˜Ÿåˆ—ç­‰å¾…,ä½†å¯ä»¥è¢«æ‰“æ–­</span>
        lock<span class="token punctuation">.</span><span class="token function">lockInterruptibly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//lock.lock(); //ä¸å¯æ‰“æ–­</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰é”çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è·å¾—äº†é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mainçº¿ç¨‹è·å¾—äº†lockï¼Œåé¢t1.startä¸­è·å¾—é”ï¼Œä¼šé˜»å¡ã€‚</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;è·å¾—äº†é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰§è¡Œæ‰“æ–­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    t1<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é”-å¯è®¾ç½®-è¶…æ—¶-trylock" tabindex="-1"><a class="header-anchor" href="#é”-å¯è®¾ç½®-è¶…æ—¶-trylock" aria-hidden="true">#</a> é”(å¯è®¾ç½®)è¶…æ—¶ï¼ˆtryLockï¼‰</h3><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Philosophers</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å¯åŠ¨...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// lock.tryLock() å°è¯•ä¸€æ¬¡è·å¾—é”ï¼Œå¦‚æœæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</span>
            <span class="token comment">// lock.tryLock(1,TimeUnit.SECONDS) å°è¯•è·å¾— N ç§’é”ï¼Œå¦‚æœæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è·å¾—äº†é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;t1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;è·å¾—äº†é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Sleeper</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-cmd line-numbers-mode" data-ext="cmd"><pre class="language-cmd"><code>2023-07-13 22:29:39,164 INFO [chapter02.Philosophers] - è·å¾—äº†é”
2023-07-13 22:29:39,166 INFO [chapter02.Philosophers] - å¯åŠ¨...
2023-07-13 22:29:39,166 INFO [chapter02.Philosophers] - è·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨-trylock-è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-trylock-è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜" aria-hidden="true">#</a> ä½¿ç”¨ tryLock è§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜</h3><p>ç¤ºä¾‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Chopstick</span> <span class="token keyword">extends</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
* ä½¿ç”¨ tryLock è§£å†³å“²å­¦å®¶æ­»é”é—®é¢˜ã€‚
* å“²å­¦å®¶æ­»é”é—®é¢˜ä¸»è¦æ˜¯ï¼Œè·å–leftç­·å­ä¹‹åï¼Œrightç­·å­æ— æ³•è·å–ã€‚
* åªè¦æ¯ä¸ªå“²å­¦å®¶å‘ç°æ— æ³•è·å–ç¬¬äºŒä¸ªç­·å­ç›´æ¥æ”¾ä¸‹ç¬¬ä¸€ä¸ªç­·å­å³å¯è§£å†³è¯¥åœºæ™¯æ­»é”é—®é¢˜ã€‚
*/</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å¾—å·¦æ‰‹ç­·å­</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span><span class="token punctuation">{</span>
                <span class="token comment">// è·å¾—å³æ‰‹ç­·å­</span>
                <span class="token comment">// ä¸€æ—¦å¤±è´¥ï¼Œç›´æ¥æ”¾ä¸‹leftç­·å­ï¼Œä¸‹ä¸€æ¬¡åœ¨æŠ¢ã€‚</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>right<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token comment">// åƒé¥­</span>
                        <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                        right<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// æ”¾ä¸‹å³æ‰‹ç­·å­</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{</span>
                left<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// æ”¾ä¸‹å·¦æ‰‹ç­·å­</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯è®¾ç½®æ˜¯å¦ä¸º-å…¬å¹³é”" tabindex="-1"><a class="header-anchor" href="#å¯è®¾ç½®æ˜¯å¦ä¸º-å…¬å¹³é”" aria-hidden="true">#</a> (å¯è®¾ç½®æ˜¯å¦ä¸º)å…¬å¹³é”</h3><p>å…¬å¹³: å…ˆæ¥å°±èƒ½å…ˆæ‰§è¡Œ</p><p>ä¸å…¬å¹³: ä¸ä¿è¯å…ˆæ¥å°±å…ˆæ‰§è¡Œ</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h1 id="å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒ" aria-hidden="true">#</a> å‚è€ƒ</h1><ul><li><p>Bç«™é»‘é©¬JUCæ•™å­¦è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV16J411h7Rd" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV16J411h7Rd<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>Bç«™å°šç¡…è°·JUCæ•™å­¦è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1ar4y1x727" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1ar4y1x727<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://github.com/Seazean/JavaNotes" target="_blank" rel="noopener noreferrer">https://github.com/Seazean/JavaNotes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p><a href="https://www.yuque.com/liuyanntes/vx9leh/wlyhor" target="_blank" rel="noopener noreferrer">https://www.yuque.com/liuyanntes/vx9leh/wlyhor<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>å¯¹è±¡å¤´çš„è§£é‡Šï¼š<a href="https://www.jianshu.com/p/3d38cba67f8b" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/3d38cba67f8b<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>å¯¹è±¡å¤´çš„è§£é‡Šï¼š<a href="https://zhuanlan.zhihu.com/p/356010805" target="_blank" rel="noopener noreferrer">https://zhuanlan.zhihu.com/p/356010805<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ç¬¬ä¸‰ç‰ˆâ€”â€”å‘¨å¿—æ˜</p></li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/juc_notes/Javaä¸­çš„é”.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><!----><div class="giscus-wrapper input-top" id="comment" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Footer test</div><div class="copyright">jimi</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/my-docs/assets/app-5c2ec4fa.js" defer></script>
  </body>
</html>
